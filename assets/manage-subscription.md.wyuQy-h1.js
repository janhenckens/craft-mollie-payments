import{_ as s,c as i,o as a,a1 as t}from"./chunks/framework.6kAX4a8T.js";const n="/craft-mollie-payments/assets/subscriptions-cancel.B_HL-2yU.png",u=JSON.parse('{"title":"Subscription form template - Mollie payments","description":"","frontmatter":{"title":"Subscription form template - Mollie payments","prev":false,"next":false},"headers":[],"relativePath":"manage-subscription.md","filePath":"manage-subscription.md"}'),e={name:"manage-subscription.md"},h=t(`<h1 id="managing-subscriptions" tabindex="-1">Managing subscriptions <a class="header-anchor" href="#managing-subscriptions" aria-label="Permalink to &quot;Managing subscriptions&quot;">​</a></h1><h2 id="front-end" tabindex="-1">Front-end <a class="header-anchor" href="#front-end" aria-label="Permalink to &quot;Front-end&quot;">​</a></h2><p>To allow users to manage their subscription(s), we need a way to authenticate them.</p><h3 id="craft-user" tabindex="-1">Craft User <a class="header-anchor" href="#craft-user" aria-label="Permalink to &quot;Craft User&quot;">​</a></h3><p>If there is a Craft user signed in when the subscription is created, the plugin will save the user&#39;s ID with a subscriber automatically.</p><p>Fetching subscriptions by a logged-in user can be done using the following function, passing the currentUser as the argument</p><div class="language-twig vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">twig</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{% </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscriptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> craft.mollie.getSubscriptionsByUser(currentUser) %}</span></span></code></pre></div><h3 id="by-e-mail" tabindex="-1">By e-mail <a class="header-anchor" href="#by-e-mail" aria-label="Permalink to &quot;By e-mail&quot;">​</a></h3><p>On sites that don&#39;t user Craft&#39;s users, the only way to authenticate a subscriptions owner is through their email address.</p><p>That flow works as follows:</p><ul><li>We have a form in which the user supplies their emailaddress</li><li>If we have a customer of the supplied address, we&#39;ll send out an email that contains a link on which the user can manage their subscription</li></ul><p>To give you control over this experience (both how it looks and how it is worded), you can use the following settings: <br></p><h4 id="template-path-for-manage-subscription-email-managesubscriptionemailpath" tabindex="-1">Template path for &quot;manage subscription&quot; email - <code>manageSubscriptionEmailPath</code> <a class="header-anchor" href="#template-path-for-manage-subscription-email-managesubscriptionemailpath" aria-label="Permalink to &quot;Template path for &quot;manage subscription&quot; email  - \`manageSubscriptionEmailPath\`&quot;">​</a></h4><p>Which template the plugin should use for this email. The link to manage the user&#39;s subscriptions is available in the <code>link</code> variable. You also have access to the full <code>subscription</code> element, with the custom fields you have set on it.</p><h4 id="subject-of-the-manage-subscription-email-managesubscriptionemailsubject" tabindex="-1">Subject of the &quot;manage subscription&quot; email - <code>manageSubscriptionEmailSubject</code> <a class="header-anchor" href="#subject-of-the-manage-subscription-email-managesubscriptionemailsubject" aria-label="Permalink to &quot;Subject of the &quot;manage subscription&quot; email - \`manageSubscriptionEmailSubject\`&quot;">​</a></h4><p>The subject for the email</p><h4 id="route-url-to-the-manage-your-subscription-managesubscriptionroute" tabindex="-1">Route/URL to the &quot;manage your subscription - <code>manageSubscriptionRoute</code> <a class="header-anchor" href="#route-url-to-the-manage-your-subscription-managesubscriptionroute" aria-label="Permalink to &quot;Route/URL to the &quot;manage your subscription - \`manageSubscriptionRoute\`&quot;">​</a></h4><p>URL where the page to manage subscriptions is located.</p><h4 id="form" tabindex="-1">Form <a class="header-anchor" href="#form" aria-label="Permalink to &quot;Form&quot;">​</a></h4><div class="language-twig vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">twig</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;post&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {{ csrfInput() }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {{ actionInput(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mollie-payments/subscription/get-link-for-customer&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">label</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;E-mail&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> required</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;submit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Find my subscription&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h4 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h4><div class="language-twig vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">twig</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{% </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> craft.app.request.getParam(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;subscriber&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) %}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{% </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscriptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> craft.mollie.getSubscriptionsByUid(uid) %}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{% </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscription </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscriptions %}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;post&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            {{ actionInput(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mollie-payments/subscription/cancel&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            {{ redirectInput(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            {{ hiddenInput(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;subscription&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, subscription.id) }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            {{ hiddenInput(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;subscriber&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, uid) }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            {{ sub.interval }} - €{{ sub.amount }} - {{ sub.email }}&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">br</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;submit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cancel subscription&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{% </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endfor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %}</span></span></code></pre></div><h2 id="control-panel" tabindex="-1">Control panel <a class="header-anchor" href="#control-panel" aria-label="Permalink to &quot;Control panel&quot;">​</a></h2><p>Subscriptions can also be managed from the control panel. For active subscriptions, a button to cancel the subscrtiption will be displayed in the sidebar.</p><p><img src="`+n+'" alt="Cancel subscriptions button"></p>',25),l=[h];function p(k,r,o,E,d,g){return a(),i("div",null,l)}const y=s(e,[["render",p]]);export{u as __pageData,y as default};
